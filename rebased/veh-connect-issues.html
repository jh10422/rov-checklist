<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROV Vehicle Connection Issues - B777 Interface</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="light-mode">

    <div class="container">
        <header>
            <a href="home.html" class="nav-arrow left">&lt;</a>
            <h1 class="danger smaller">► VEHICLE CONNECTION ISSUES ◄</h1>
            <a href="#" class="nav-arrow right disabled">&gt;</a>
        </header>

        <div class="sub-tabs-container">
            <button class="sub-tab">Physical Connection</button>
            <button class="sub-tab">Software Connection</button>
            <button class="sub-tab">Vehicle Connection</button>
        </div>

        <div class="progress-text" id="progress-text">0 / 1 ITEMS COMPLETE</div>
        <div class="tab-title" id="tab-title"></div>
        
        <div class="page-content" id="page-content">
            <div class="page active">
                <div class="scroll-wrapper">
                    <table>
                        <tbody>
                            <tr class="checklist-item">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">MODE</span><span class="dots"></span><span class="item-status">Manual</span></td>
                            </tr>
                            <tr class="checklist-item">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Vehicle Arming</span><span class="dots"></span><span class="item-status">Confirm DISARMED</span></td>
                            </tr>
                            <tr class="checklist-item" data-prereq-for="q1">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Control Station Cable</span><span class="dots"></span><span class="item-status">Disconnected</span></td>
                            </tr>
                            <tr class="instruction">
                                <td colspan="2">- Wait 5 Seconds -</td>
                            </tr>
                            <tr class="checklist-item" data-prereq-for="q1">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Control Station Cable</span><span class="dots"></span><span class="item-status">Connected</span></td>
                            </tr>
                            <tr class="checklist-item" data-prereq-for="q1">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Tether Spool Cable</span><span class="dots"></span><span class="item-status">Disconnected</span></td>
                            </tr>
                            <tr class="instruction">
                                <td colspan="2">- Wait 5 Seconds -</td>
                            </tr>
                            <tr class="checklist-item" data-prereq-for="q1">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Tether Spool Cable</span><span class="dots"></span><span class="item-status">Connected</span></td>
                            </tr>

                            <tr class="checklist-item is-question" id="q1">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Is connection restored?</span></td>
                            </tr>
                            <tr class="options-row" data-question="q1">
                                <td colspan="2">
                                    <button class="option-btn" data-choice="yes" disabled>YES</button>
                                    <button class="option-btn" data-choice="no" disabled>NO</button>
                                </td>
                            </tr>

                            <tr class="instruction conditional" data-path="q1-no">
                                <td colspan="2">PROCEED TO THE NEXT PAGE</td>
                            </tr>

                            <tr class="checklist-item conditional" data-path="q1-yes" data-prereq-for="q2">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Pilot Gain</span><span class="dots"></span><span class="item-status">Set to 25%</span></td>
                            </tr>

                            <tr class="checklist-item is-question conditional" id="q2" data-path="q1-yes">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Is the vehicle able to arm?</span></td>
                            </tr>
                            <tr class="options-row conditional" data-question="q2" data-path="q1-yes">
                                <td colspan="2">
                                    <button class="option-btn" data-choice="yes" disabled>YES</button>
                                    <button class="option-btn" data-choice="no" disabled>NO</button>
                                </td>
                            </tr>

                            <tr class="instruction conditional" data-path="q2-no">
                                <td colspan="2">PROCEED TO THE NEXT PAGE</td>
                            </tr>

                            <tr class="checklist-item conditional" data-path="q2-yes" data-prereq-for="q3">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Vehicle Arming</span><span class="dots"></span><span class="item-status">Confirm ARMED</span></td>
                            </tr>
                            <tr class="instruction conditional" data-path="q2-yes">
                                <td colspan="2">- Slowly Test Pilot Input -</td>
                            </tr>

                            <tr class="checklist-item is-question conditional" id="q3" data-path="q2-yes">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Are functions restored?</span></td>
                            </tr>
                            <tr class="options-row conditional" data-question="q3" data-path="q2-yes">
                                <td colspan="2">
                                    <button class="option-btn" data-choice="yes" disabled>YES</button>
                                    <button class="option-btn" data-choice="no" disabled>NO</button>
                                </td>
                            </tr>

                            <tr class="instruction success conditional" data-path="q3-yes">
                                <td colspan="2">Continue with Mission</td>
                            </tr>

                            <tr class="instruction conditional" data-path="q3-no">
                                <td colspan="2">PROCEED TO THE NEXT PAGE</td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="page">
                <div class="scroll-wrapper">
                    <table>
                        <tbody>
                            <tr class="checklist-item is-question" id="sw-q1">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Are you able to reach BlueOS UI?</span></td>
                            </tr>
                            <tr class="options-row" data-question="sw-q1">
                                <td colspan="2">
                                    <button class="option-btn" data-choice="yes">YES</button>
                                    <button class="option-btn" data-choice="no">NO</button>
                                </td>
                            </tr>

                            <tr class="instruction conditional" data-path="sw-q1-no">
                                <td colspan="2">Proceed to Next Page</td>
                            </tr>


                            <tr class="checklist-item conditional" data-path="sw-q1-yes" data-prereq-for="sw-q2">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Auto Pilot</span><span class="dots"></span><span class="item-status">Restart</span></td>
                            </tr>
                            <tr class="checklist-item conditional" data-path="sw-q1-yes" data-prereq-for="sw-q2">
                                <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Cockpit</span><span class="dots"></span><span class="item-status">Restart</span></td>
                             </tr>
                            <tr class="instruction conditional" data-path="sw-q1-yes">
                                <td colspan="2">- Wait 10 seconds -</td>
                            </tr>
                            <tr class="checklist-item conditional" data-path="sw-q1-yes" data-prereq-for="sw-q2">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Pilot Gain</span><span class="dots"></span><span class="item-status">Set to 25%</span></td>
                            </tr>
                            <tr class="checklist-item conditional" data-path="sw-q1-yes" data-prereq-for="sw-q2">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Vehicle Arming</span><span class="dots"></span><span class="item-status">Confirm ARMED</span></td>
                            </tr>

                            <tr class="checklist-item is-question conditional" id="sw-q2" data-path="sw-q1-yes">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Is the vehicle able to arm?</span></td>
                            </tr>
                            <tr class="options-row conditional" data-question="sw-q2" data-path="sw-q1-yes">
                                <td colspan="2">
                                    <button class="option-btn" data-choice="yes" disabled>YES</button>
                                    <button class="option-btn" data-choice="no" disabled>NO</button>
                                </td>
                            </tr>

                            <tr class="instruction conditional" data-path="sw-q2-yes">
                                <td colspan="2">- Slowly Test Pilot Input -</td>
                            </tr>

                            <tr class="checklist-item is-question conditional" id="sw-q3" data-path="sw-q2-yes">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Are functions restored?</span></td>
                            </tr>
                            <tr class="options-row conditional" data-question="sw-q3" data-path="sw-q2-yes">
                                <td colspan="2">
                                    <button class="option-btn" data-choice="yes">YES</button>
                                    <button class="option-btn" data-choice="no">NO</button>
                                </td>
                            </tr>

                            <tr class="instruction success conditional" data-path="sw-q3-yes">
                                <td colspan="2">Continue with Mission</td>
                            </tr>

                            <tr class="instruction conditional" data-path="sw-q3-no">
                                <td colspan="2">Proceed to Next Page</td>
                            </tr>

                            <tr class="checklist-item conditional" data-path="sw-q2-no" id="blueos-restart-item">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">BlueOS</span><span class="dots"></span><span class="item-status">Full Restart</span></td>
                            </tr>
                            <tr class="instruction" id="blueos-restart-instruction" style="display: none;">
                                <td colspan="2">- Wait until BlueOS is fully restarted >30 sec - If the vehicle is able to ARM: Re-Select YES on the item above. If STILL NO: Proceed to Next Page</td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="page">
                <div class="scroll-wrapper">
                    <table>
                        <tbody>
                            <tr class="checklist-item is-question" id="vc-q1">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Is the Vehicle in the Water?</span></td>
                            </tr>
                            <tr class="options-row" data-question="vc-q1">
                                <td colspan="2">
                                    <button class="option-btn" data-choice="yes">YES</button>
                                    <button class="option-btn" data-choice="no">NO</button>
                                </td>
                            </tr>

                            <tr class="instruction conditional" data-path="vc-q1-yes">
                                <td colspan="2">- Retrieve Vehicle First -</td>
                            </tr>
                            <tr class="instruction conditional" data-path="vc-q1-yes">
                                <td colspan="2">- Proceed with Checklist -</td>
                            </tr>

                            <tr class="checklist-item conditional" data-path="vc-q1-no,vc-q1-yes" data-prereq-for="vc-q2">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Vehicle Tether</span><span class="dots"></span><span class="item-status">Disconnected</span></td>
                            </tr>
                            <tr class="instruction conditional" data-path="vc-q1-no,vc-q1-yes">
                                <td colspan="2">- Wait 5 seconds -</td>
                            </tr>
                            <tr class="checklist-item conditional" data-path="vc-q1-no,vc-q1-yes" data-prereq-for="vc-q2">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Vehicle Tether</span><span class="dots"></span><span class="item-status">Connected</span></td>
                            </tr>

                            <tr class="checklist-item is-question conditional" id="vc-q2" data-path="vc-q1-no,vc-q1-yes">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Are you able to reach BlueOS UI?</span></td>
                            </tr>
                            <tr class="options-row conditional" data-question="vc-q2" data-path="vc-q1-no,vc-q1-yes">
                                <td colspan="2">
                                    <button class="option-btn" data-choice="yes" disabled>YES</button>
                                    <button class="option-btn" data-choice="no" disabled>NO</button>
                                </td>
                            </tr>

                            <tr class="checklist-item conditional" data-path="vc-q2-no" id="vc-battery-disconnect-item" data-prereq-for="vc-q2b">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Vehicle Battery Connectors (GROUND)</span><span class="dots"></span><span class="item-status">Disconnected</span></td>
                            </tr>
                            <tr class="instruction conditional" data-path="vc-q2-no">
                                <td colspan="2">- Wait 5 seconds -</td>
                            </tr>
                            <tr class="checklist-item conditional" data-path="vc-q2-no" data-prereq-for="vc-q2b">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Vehicle Battery Connectors (GROUND)</span><span class="dots"></span><span class="item-status">Connected</span></td>
                            </tr>

                            <tr class="checklist-item is-question conditional" id="vc-q2b" data-path="vc-q2-no">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Do You Hear the Startup Beeps?</span></td>
                            </tr>
                            <tr class="options-row conditional" data-question="vc-q2b" data-path="vc-q2-no">
                                <td colspan="2">
                                    <button class="option-btn" data-choice="yes" disabled>YES</button>
                                    <button class="option-btn" data-choice="no" disabled>NO</button>
                                </td>
                            </tr>

                            <tr class="checklist-item conditional" data-path="vc-q2b-no" id="vc-battery-check-item">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Battery Connection</span><span class="dots"></span><span class="item-status">Double Check Connection</span></td>
                            </tr>
                            <tr class="instruction" id="vc-battery-try-again-instruction" style="display: none;">
                                <td colspan="2">Try again. If still NO: <a href="abort-mission.html" class="action-btn">Abort Mission Checklist</a></td>
                            </tr>
                            <tr class="instruction" id="vc-q2b-reselect-instruction" style="display: none;">
                                <td colspan="2">If Startup Beeps are heard, reselect the item above to YES.</td>
                            </tr>

                            <tr class="instruction conditional" data-path="vc-q2b-yes">
                                <td colspan="2">- Wait for 5 minutes -</td>
                            </tr>
                            <tr class="checklist-item conditional" data-path="vc-q2b-yes" id="vc-blueos-wait-item">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">5 Minute Wait</span><span class="dots"></span><span class="item-status">Complete</span></td>
                            </tr>
                            <tr class="instruction" id="vc-blueos-restore-instruction" style="display: none;">
                                <td colspan="2">Confirm if connection to BlueOS is restored, if no <a href="abort-mission.html" class="action-btn">Abort Mission</a>. If yes reselect the item above for BlueOS as YES</td>
                            </tr>

                            <tr class="checklist-item conditional" data-path="vc-q2-yes" data-prereq-for="vc-q3">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Pilot Gain</span><span class="dots"></span><span class="item-status">Set to 25%</span></td>
                            </tr>
                            <tr class="checklist-item conditional" data-path="vc-q2-yes" data-prereq-for="vc-q3">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Vehicle Arming</span><span class="dots"></span><span class="item-status">Confirm ARMED</span></td>
                            </tr>

                            <tr class="checklist-item is-question conditional" id="vc-q3" data-path="vc-q2-yes">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Is the vehicle able to arm?</span></td>
                            </tr>
                            <tr class="options-row conditional" data-question="vc-q3" data-path="vc-q2-yes">
                                <td colspan="2">
                                    <button class="option-btn" data-choice="yes" disabled>YES</button>
                                    <button class="option-btn" data-choice="no" disabled>NO</button>
                                </td>
                            </tr>

                            <tr class="action-row conditional" data-path="vc-q3-no">
                                <td colspan="2"><a href="veh-arming.html" class="action-btn">GO to Vehicle Arming Issue PAGE</a></td>
                            </tr>

                            <tr class="instruction conditional" data-path="vc-q3-yes">
                                <td colspan="2">- Slowly Test Pilot Input -</td>
                            </tr>

                            <tr class="checklist-item is-question conditional" id="vc-q4" data-path="vc-q3-yes">
                               <td class="item-cell"><span class="checklist-box"></span><span class="item-name">Are functions restored?</span></td>
                            </tr>
                            <tr class="options-row conditional" data-question="vc-q4" data-path="vc-q3-yes">
                                <td colspan="2">
                                    <button class="option-btn" data-choice="yes">YES</button>
                                    <button class="option-btn" data-choice="no">NO</button>
                                </td>
                            </tr>

                            <tr class="instruction success conditional" data-path="vc-q4-yes">
                                <td colspan="2">Continue with Mission</td>
                            </tr>

                            <tr class="action-row conditional" data-path="vc-q4-no">
                                <td colspan="2"><a href="veh-function.html" class="action-btn">GO to Vehicle Function Issue PAGE</a></td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>

            <div class="scroll-controls">
                <button id="scroll-up-btn" class="scroll-btn">▲</button>
                <button id="scroll-down-btn" class="scroll-btn">▼</button>
            </div>
        </div>
        
        <footer class="page-footer">
            <div id="pager-controls">
                <div class="nav-controls">
                    <button id="prev-page-btn" class="footer-btn">&lt; PREV PAGE</button>
                </div>
                <div id="page-indicator">1 / 3</div>
                <div class="nav-controls">
                    <button id="next-page-btn" class="footer-btn">NEXT PAGE &gt;</button>
                </div>
            </div>
            <a href="home.html" id="next-checklist-btn" class="footer-btn" style="display: none;">GO TO HOME</a>
        </footer>
        <footer class="theme-footer">
            <a href="home.html" class="footer-btn">HOME</a>
            <span style="width: 20px;"></span>
            <button id="zoom-out-btn" class="footer-btn" title="Zoom Out">-</button>
            <span style="padding: 0 10px;">ZOOM</span>
            <button id="zoom-in-btn" class="footer-btn" title="Zoom In">+</button>
            <span style="width: 20px;"></span>
            <button id="theme-toggle" class="footer-btn">DARK MODE</button>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
           const body = document.body;
           const themeToggle = document.getElementById('theme-toggle');
           const zoomInBtn = document.getElementById('zoom-in-btn');
           const zoomOutBtn = document.getElementById('zoom-out-btn');
           
           const checklistItems = document.querySelectorAll('.checklist-item');
           const progressText = document.getElementById('progress-text');
           
           const pages = document.querySelectorAll('.page');
           const subTabs = document.querySelectorAll('.sub-tab');
           const prevBtn = document.getElementById('prev-page-btn');
           const nextBtn = document.getElementById('next-page-btn');
           const pageIndicator = document.getElementById('page-indicator');
           const tabTitle = document.getElementById('tab-title');
        
           const pagerControls = document.getElementById('pager-controls');
           const nextChecklistBtn = document.getElementById('next-checklist-btn');
           
           const optionBtns = document.querySelectorAll('.options-row .option-btn');
           const pageContent = document.getElementById('page-content');
           const scrollUpBtn = document.getElementById('scroll-up-btn');
           const scrollDownBtn = document.getElementById('scroll-down-btn');
        
           const pageTitles = ['PHYSICAL CONNECTION', 'SOFTWARE CONNECTION', 'VEHICLE CONNECTION'];
           let currentPage = 0;
           const totalPages = pages.length;
           let scrollPositions = Array(totalPages).fill(0);
        
           // --- ZOOM FUNCTIONALITY ---
           let currentZoom = 1.0;
        
           function applyZoom(zoomLevel) {
               body.style.zoom = zoomLevel;
           }
        
           function saveAndApplyZoom(zoomLevel) {
               const clampedZoom = Math.max(0.5, Math.min(zoomLevel, 2.0));
               currentZoom = clampedZoom;
               applyZoom(currentZoom);
               localStorage.setItem('rovChecklistZoom', currentZoom);
           }
        
           zoomInBtn.addEventListener('click', () => saveAndApplyZoom(currentZoom + 0.1));
           zoomOutBtn.addEventListener('click', () => saveAndApplyZoom(currentZoom - 0.1));
        
           // --- THEME FUNCTIONALITY ---
           themeToggle.addEventListener('click', () => {
               body.classList.toggle('light-mode');
               const currentTheme = body.classList.contains('light-mode') ? 'light-mode' : 'dark-mode';
               themeToggle.textContent = body.classList.contains('light-mode') ? 'DARK MODE' : 'LIGHT MODE';
               localStorage.setItem('theme', currentTheme);
           });
        
           // --- SCROLL FUNCTIONALITY ---
           function updateScrollState() {
               const activeWrapper = document.querySelector('.page.active .scroll-wrapper');
               if (!activeWrapper) return;
        
               void activeWrapper.offsetHeight;
        
               const contentHeight = activeWrapper.scrollHeight;
               const containerHeight = pageContent.clientHeight;
               const currentScroll = scrollPositions[currentPage];
               
               // **TWEAK**: Added a small buffer back for more comfortable scrolling.
               const footerBuffer = 50;
               
               if (contentHeight <= containerHeight) {
                   scrollUpBtn.disabled = true;
                   scrollDownBtn.disabled = true;
                   return;
               }
        
               scrollUpBtn.disabled = currentScroll >= 0;
               const maxScroll = -(contentHeight - containerHeight + footerBuffer);
               scrollDownBtn.disabled = currentScroll <= maxScroll;
               
               if (currentScroll < 0) {
                   scrollUpBtn.disabled = false;
               }
           }
        
           function scrollContent(direction, amount = null) {
               const activeWrapper = document.querySelector('.page.active .scroll-wrapper');
               if (!activeWrapper) return;
        
               const containerHeight = pageContent.clientHeight;
               const contentHeight = activeWrapper.scrollHeight;
               const scrollStep = amount !== null ? amount : containerHeight * 0.7;
               
               let newScrollY = scrollPositions[currentPage];
               if (direction === 'down') {
                   newScrollY -= scrollStep;
               } else {
                   newScrollY += scrollStep;
               }
        
               // **TWEAK**: Added a small buffer back for more comfortable scrolling.
               const footerBuffer = 50;
               const maxScroll = -(contentHeight - containerHeight + footerBuffer);
               
               newScrollY = Math.max(newScrollY, maxScroll);
               newScrollY = Math.min(newScrollY, 0);
        
               scrollPositions[currentPage] = newScrollY;
               activeWrapper.style.transform = `translateY(${newScrollY}px)`;
           }
           
           function scrollIntoViewIfNeeded(element) {
               if (!element) return;
               
               setTimeout(() => {
                   const activeWrapper = document.querySelector('.page.active .scroll-wrapper');
                   if (!activeWrapper) return;
                   
                   void activeWrapper.offsetHeight;
                   
                   const itemRect = element.getBoundingClientRect();
                   const containerRect = pageContent.getBoundingClientRect();
                   
                   if (itemRect.top < containerRect.top + 20 || itemRect.bottom > containerRect.bottom - 20) {
                       const scrollAmount = itemRect.top - containerRect.top - 20;
                       scrollContent('down', scrollAmount);
                   }
                   
                   updateScrollState();
               }, 300);
           }
        
           function forceScrollUpdate() {
               setTimeout(updateScrollState, 300);
           }
        
           scrollUpBtn.addEventListener('click', () => {
               scrollContent('up');
               updateScrollState();
           });
        
           scrollDownBtn.addEventListener('click', () => {
               scrollContent('down');
               updateScrollState();
           });
        
           // --- CHECKLIST LOGIC ---
           function checkPrerequisites() {
               document.querySelectorAll('.options-row').forEach(row => {
                   const questionId = row.dataset.question;
                   const prereqItems = document.querySelectorAll(`[data-prereq-for="${questionId}"]`);
                   let allPrereqsMet = prereqItems.length > 0 ? 
                       [...prereqItems].every(item => item.classList.contains('checked')) : 
                       true;
        
                   row.querySelectorAll('.option-btn').forEach(btn => {
                       if (!btn.closest('.options-row').classList.contains('selection-made')) {
                          btn.disabled = !allPrereqsMet;
                       }
                   });
               });
               
               forceScrollUpdate();
           }
        
           function updateFooter() {
               const missionComplete = checkAllTabsComplete();
               if (missionComplete) {
                   pagerControls.style.display = 'none';
                   nextChecklistBtn.style.display = 'block';
               } else {
                   pagerControls.style.display = 'flex';
                   nextChecklistBtn.style.display = 'none';
               }
           }
        
           function updateProgress() {
               const allCheckableItems = document.querySelectorAll('.checklist-item:not(.is-question)');
               const totalItems = allCheckableItems.length;
               const checkedItemsCount = document.querySelectorAll('.checklist-item:not(.is-question).checked').length;
        
               progressText.textContent = `${checkedItemsCount} / ${totalItems} ITEMS COMPLETE`;
               
               checkTabCompletion();
               
               const allTabsComplete = checkAllTabsComplete();
               
               if (allTabsComplete) {
                   progressText.textContent = 'TROUBLESHOOTING COMPLETE - MISSION READY';
                   progressText.style.color = 'var(--complete-color)';
               } else {
                   progressText.style.color = 'var(--dim-text-color)';
               }
               
               checkPrerequisites();
               updateFooter();
               
               forceScrollUpdate();
           }
        
           function checkAllTabsComplete() {
               const physicalMissionComplete = document.querySelector('.instruction.conditional[data-path="q3-yes"]')?.style.display === 'table-row';
               const softwareMissionComplete = document.querySelector('.instruction.conditional[data-path="sw-q3-yes"]')?.style.display === 'table-row';
               const vehicleMissionComplete = document.querySelector('.instruction.conditional[data-path="vc-q4-yes"]')?.style.display === 'table-row';
               
               return physicalMissionComplete || softwareMissionComplete || vehicleMissionComplete;
           }
        
            function checkTabCompletion() {
                const nextPageBtn = document.getElementById('next-page-btn');
                if (!nextPageBtn) return;
        
                let shouldHighlight = false;
                
                const currentPageElement = pages[currentPage];
                if (!currentPageElement) return;
        
                if (currentPage === 0) {
                    shouldHighlight = currentPageElement.querySelector('.instruction.conditional[data-path="q1-no"]')?.style.display === 'table-row' ||
                                      currentPageElement.querySelector('.instruction.conditional[data-path="q2-no"]')?.style.display === 'table-row' ||
                                      currentPageElement.querySelector('.instruction.conditional[data-path="q3-no"]')?.style.display === 'table-row';
                } else if (currentPage === 1) {
                    shouldHighlight = currentPageElement.querySelector('.instruction.conditional[data-path="sw-q1-no"]')?.style.display === 'table-row' ||
                                      currentPageElement.querySelector('.instruction.conditional[data-path="sw-q3-no"]')?.style.display === 'table-row' ||
                                      currentPageElement.querySelector('#blueos-restart-instruction')?.style.display === 'table-row';
                }
                
                if (shouldHighlight && currentPage < totalPages - 1) {
                    nextPageBtn.classList.add('highlighted');
                } else {
                    nextPageBtn.classList.remove('highlighted');
                }
            }
        
           function showPage(pageIndex) {
               pages.forEach((page, index) => page.classList.toggle('active', index === pageIndex));
               subTabs.forEach((tab, index) => tab.classList.toggle('active', index === pageIndex));
               tabTitle.textContent = pageTitles[pageIndex];
               pageIndicator.textContent = `${pageIndex + 1} / ${totalPages}`;
               prevBtn.disabled = pageIndex === 0;
               nextBtn.disabled = pageIndex === totalPages - 1;
               
               setTimeout(() => {
                   const activeWrapper = document.querySelector('.page.active .scroll-wrapper');
                   if (activeWrapper) {
                       activeWrapper.style.transform = `translateY(${scrollPositions[pageIndex]}px)`;
                   }
                   updateProgress();
               }, 150);
           }
        
           checklistItems.forEach(item => {
               if (!item.classList.contains('is-question')) {
                   item.addEventListener('click', (e) => {
                       if (e.target.closest('a')) return;
                       item.classList.toggle('checked');
        
                       if (item.id === 'blueos-restart-item') {
                           const instructionElement = document.getElementById('blueos-restart-instruction');
                           if (instructionElement) {
                               instructionElement.style.display = item.classList.contains('checked') ? 'table-row' : 'none';
                               if (item.classList.contains('checked')) {
                                   const sw2Row = document.querySelector('.options-row[data-question="sw-q2"]');
                                   if (sw2Row?.classList.contains('selection-made')) {
                                       sw2Row.classList.remove('selection-made');
                                       sw2Row.querySelectorAll('.option-btn').forEach(btn => {
                                           btn.disabled = false;
                                           btn.classList.remove('selected');
                                       });
                                       document.getElementById('sw-q2').classList.remove('checked');
                                   }
                                   scrollIntoViewIfNeeded(instructionElement);
                               }
                           }
                       }
        
                       if (item.id === 'vc-battery-check-item') {
                           const reselectionInstruction = document.getElementById('vc-q2b-reselect-instruction');
                           const tryAgainInstruction = document.getElementById('vc-battery-try-again-instruction');
                           
                           if (item.classList.contains('checked')) {
                               if (reselectionInstruction) reselectionInstruction.style.display = 'table-row';
                               if (tryAgainInstruction) tryAgainInstruction.style.display = 'table-row';
                               
                               const vc2bRow = document.querySelector('.options-row[data-question="vc-q2b"]');
                               if (vc2bRow?.classList.contains('selection-made')) {
                                   vc2bRow.classList.remove('selection-made');
                                   vc2bRow.querySelectorAll('.option-btn').forEach(btn => {
                                       btn.disabled = false;
                                       btn.classList.remove('selected');
                                   });
                                   document.getElementById('vc-q2b').classList.remove('checked');
                               }
                               scrollIntoViewIfNeeded(tryAgainInstruction);
                           } else {
                               if (reselectionInstruction) reselectionInstruction.style.display = 'none';
                               if (tryAgainInstruction) tryAgainInstruction.style.display = 'none';
                           }
                       }
        
                       if (item.id === 'vc-blueos-wait-item') {
                           const instructionElement = document.getElementById('vc-blueos-restore-instruction');
                           if (instructionElement) {
                               instructionElement.style.display = item.classList.contains('checked') ? 'table-row' : 'none';
                               if (item.classList.contains('checked')) {
                                   const vc2Row = document.querySelector('.options-row[data-question="vc-q2"]');
                                   if (vc2Row?.classList.contains('selection-made')) {
                                       vc2Row.classList.remove('selection-made');
                                       vc2Row.querySelectorAll('.option-btn').forEach(btn => {
                                           btn.disabled = false;
                                           btn.classList.remove('selected');
                                       });
                                       document.getElementById('vc-q2').classList.remove('checked');
                                   }
                                   scrollIntoViewIfNeeded(instructionElement);
                               }
                           }
                       }
        
                       updateProgress();
        
                       const prereqFor = item.dataset.prereqFor;
                       if (prereqFor) {
                           const allPrereqs = document.querySelectorAll(`[data-prereq-for="${prereqFor}"]`);
                           const allMet = [...allPrereqs].every(pr => pr.classList.contains('checked'));
                           if (allMet) {
                               const questionElement = document.getElementById(prereqFor);
                               scrollIntoViewIfNeeded(questionElement);
                           }
                       }
                   });
               }
           });
        
           optionBtns.forEach(btn => {
               btn.addEventListener('click', (e) => {
                   if(btn.disabled) return;
                   const choice = e.target.dataset.choice;
                   const questionRow = e.target.closest('.options-row');
                   if (!questionRow) return; 
                   const questionId = questionRow.dataset.question;
                   const questionItem = document.getElementById(questionId);
                   questionItem.classList.add('checked');
                   questionRow.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                   e.target.classList.add('selected');
                   questionRow.classList.add('selection-made');
                   questionRow.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
                   
                   if (questionId === 'vc-q2b' && choice === 'yes') {
                       document.getElementById('vc-q2b-reselect-instruction')?.style.setProperty('display', 'none', 'important');
                       document.getElementById('vc-battery-try-again-instruction')?.style.setProperty('display', 'none', 'important');
                   }
                   if (questionId === 'vc-q2' && choice === 'yes') {
                       document.getElementById('vc-blueos-restore-instruction')?.style.setProperty('display', 'none', 'important');
                   }
                   if (questionId === 'sw-q2' && choice === 'yes') {
                       document.getElementById('blueos-restart-instruction')?.style.setProperty('display', 'none', 'important');
                   }
        
                   const currentPageElement = pages[currentPage];
                   
                   currentPageElement.querySelectorAll(`[data-path]`).forEach(el => {
                      if(el.dataset.path.startsWith(questionId) && !el.dataset.path.includes(`${questionId}-${choice}`)) {
                          el.style.display = 'none';
                      }
                   });
        
                   const pathsToShow = currentPageElement.querySelectorAll(`[data-path*="${questionId}-${choice}"]`);
                   pathsToShow.forEach(el => {
                       el.style.display = el.tagName === 'TR' ? 'table-row' : 'block';
                   });
                   
                   updateProgress();
                   
                   if (pathsToShow.length > 0) {
                       const firstNewItem = pathsToShow[0];
                       scrollIntoViewIfNeeded(firstNewItem);
                   } else {
                       forceScrollUpdate();
                   }
               });
           });
        
           subTabs.forEach((tab, index) => {
               tab.addEventListener('click', () => {
                   currentPage = index;
                   showPage(currentPage);
               });
           });
        
           prevBtn.addEventListener('click', () => {
               if (currentPage > 0) {
                   currentPage--;
                   showPage(currentPage);
               }
           });
        
           nextBtn.addEventListener('click', () => {
               if (currentPage < totalPages - 1) {
                   currentPage++;
                   showPage(currentPage);
               }
           });
        
           // --- INITIAL LOAD ---
           function initialize() {
               const savedTheme = localStorage.getItem('theme') || 'light-mode';
               if (savedTheme === 'dark-mode') {
                   body.classList.remove('light-mode');
               } else {
                   body.classList.add('light-mode');
               }
               themeToggle.textContent = body.classList.contains('light-mode') ? 'DARK MODE' : 'LIGHT MODE';
        
               const savedZoom = parseFloat(localStorage.getItem('rovChecklistZoom')) || 1.0;
               currentZoom = savedZoom;
               applyZoom(currentZoom);
               
               showPage(currentPage);
           }
        
           initialize();
        });
        </script>
</body>
</html>